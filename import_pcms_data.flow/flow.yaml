summary: Ralph import PCMS data
description: ''
value:
  modules:
    - id: a
      summary: PCMS XML to JSON
      value:
        type: rawscript
        content: '!inline pcms_xml_to_json.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          s3_key:
            type: javascript
            expr: flow_input.s3_key
        lock: '!inline pcms_xml_to_json.inline_script.lock'
        language: python3
    - id: b
      summary: Lookups
      value:
        type: rawscript
        content: '!inline lookups.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: '!inline lookups.inline_script.lock'
        language: bun
    - id: c
      summary: People & Identity
      value:
        type: rawscript
        content: '!inline people_&_identity.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: '!inline people_&_identity.inline_script.lock'
        language: bun
    - id: d
      summary: Draft
      value:
        type: rawscript
        content: '!inline draft.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: '!inline draft.inline_script.lock'
        language: bun
    - id: e
      summary: Contracts
      value:
        type: rawscript
        content: '!inline contracts.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: '!inline contracts.inline_script.lock'
        language: bun
    - id: f
      summary: Team Exceptions
      value:
        type: rawscript
        content: '!inline team_exceptions.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: '!inline team_exceptions.inline_script.lock'
        language: bun
    - id: g
      summary: 'Transactions (Trades, Ledger, Waiver Amounts)'
      value:
        type: rawscript
        content: '!inline transactions_(trades,_ledger,_waiver_amounts).inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: >-
          !inline
          transactions_(trades,_ledger,_waiver_amounts).inline_script.lock
        language: bun
    - id: h
      summary: League Config
      value:
        type: rawscript
        content: '!inline league_config.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: '!inline league_config.inline_script.lock'
        language: bun
    - id: i
      summary: Team Financials
      value:
        type: rawscript
        content: '!inline team_financials.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: '!inline team_financials.inline_script.lock'
        language: bun
    - id: j
      summary: Two-Way
      value:
        type: rawscript
        content: '!inline two-way.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          extract_dir:
            type: javascript
            expr: '''./shared/pcms'''
        lock: '!inline two-way.inline_script.lock'
        language: bun
    - id: k
      summary: Finalize Lineage
      value:
        type: rawscript
        content: '!inline finalize_lineage.inline_script.ts'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          summaries:
            type: javascript
            expr: >-
              [results.a, results.b, results.c, results.d, results.e, results.f,
              results.g, results.h, results.i, results.j]
        lock: '!inline finalize_lineage.inline_script.lock'
        language: bun
  same_worker: true
schema:
  $schema: 'https://json-schema.org/draft/2020-12/schema'
  type: object
  order:
    - dry_run
    - s3_key
  properties:
    dry_run:
      type: boolean
      description: Preview changes without writing to DB
      default: false
    s3_key:
      type: string
      description: S3 key for PCMS extract ZIP
      default: pcms/nba_pcms_full_extract.zip
