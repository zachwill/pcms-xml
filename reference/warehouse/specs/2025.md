# 2025 Spec

**Source:** `reference/warehouse/2025.json`  
**Rows:** 74 (season-specific team Salary Book view)

---

## 1. Purpose

The **2025** sheet is a **2025 season snapshot** of the Playground view. It provides:

- Team roster with salaries across 6 years (2025–2030)
- % of cap for each player
- Trade kicker (TK) column
- Luxury Tax and Apron salary columns (R–U) for 2025 and 2026
- Roster fill calculations (Rookie Mins, Vet Mins)
- Team totals vs Cap / Tax / Apron 1 / Apron 2 thresholds
- Luxury tax payment estimates with repeater flag support
- Draft pick ownership grid (1st/2nd round, 2026–2032)
- Depth Chart mini-view
- Contract Calculator blocks

Functionally identical to `playground.json` but dedicated to 2025 season analysis (base year = 2025).

---

## 2. Key Inputs / Controls

| Cell | Label | Sample Value | Purpose |
|------|-------|--------------|---------|
| `D1` | Team Code | `POR` | User selects team (3-letter code) |
| `E1` | Base Year | `2025` | Starting year (frozen to 2025) |
| `F1` | `=TODAY()` | (dynamic) | Current date for proration calcs |
| `H1` | Days remaining | `=DATE(2026,4,12)-F1+1` | Days left in 2025-26 season |
| `I1` | "Repeater in '25" | label | — |
| `J1` | Repeater '25 | `Yes`/`No` | IF-chain: BOS/PHX/DEN/GSW/LAL/MIL/LAC = Yes, else No |
| `L1` | "Repeater in '26" | label | — |
| `N1` | Repeater '26 | `Yes`/`No` | Similar IF-chain for 2026 |
| `AH3` | Contract total | `150000000` | Contract calculator: total value |
| `AH4` | % Raise | `0.08` | Contract calculator: annual raise % |
| `AO3` | Start salary | `=1.4*E25` | Alternate calc: start from player E25 |

---

## 3. Key Outputs

### Player Roster (rows 4–40)

| Column | Header | Description |
|--------|--------|-------------|
| A | (sorted name) | LET/FILTER formula: Y warehouse filtered by team, sorted descending by salary |
| C | # | Row count of players with salary >1000 |
| D | Player | Display name (mirrors A unless 0) |
| E,G,I,K,M,O | 2025–2030 | Cap salary from Y warehouse |
| F,H,J,L,N,P | % | Salary / team total (E50) |
| Q | TK | Trade kicker % from Y column P |
| R | Tax 2025 | Luxury tax salary for 2025 (from Y!$R:$X) |
| S | Apron 2025 | Apron salary for 2025 (from Y!$Y:$AE) |
| T | Tax 2026 | Luxury tax salary for 2026 |
| U | Apron 2026 | Apron salary for 2026 |

### Depth Chart (rows 4–17, columns W–AA)

| Column | Purpose |
|--------|---------|
| W | Year label (2025, 2026, etc.) |
| W–AA | Player names by position groupings |

Rows 4–9: 2025 depth  
Row 11: "2026" label  
Rows 12–17: 2026 depth

### Contract Calculator (rows 3–12, columns AC–AO)

Two calculator blocks side-by-side:

**Block 1: "Contract Calculator - Total" (AC–AH)**
| Cell | Description |
|------|-------------|
| AC3 | "Yrs" header |
| AD3 | "Salary" header |
| AE3 | "% Raise" header |
| AH3 | Total contract value input (e.g., 150000000) |
| AH4 | % Raise input (e.g., 0.08) |
| AD4 | `=AH3/AE12` — start salary from total/coefficient |
| AE4–AE9 | Cumulative raise % (1, 1.08, 1.16, ...) |
| AD5–AD9 | `=ROUNDDOWN($AD$4*AE5,3)` — annual salary |
| AD10 | `=SUM(AD4:AD8)` — verification sum |
| AE12 | `=SUM(AE4:AE9)` — coefficient sum |

**Block 2: "Contract Calculator - Start Number" (AJ–AO)**
| Cell | Description |
|------|-------------|
| AK4 | `=AO3` — starting salary from input |
| AK5–AK9 | `=ROUNDDOWN($AK$4*AL5,3)` — annual salary |
| AK10 | `=SUM(AK4:AK8)` — total value |
| AL4–AL9 | Raise multipliers |

### Team Totals Block (rows 41–62)

| Row | D label | Formula pattern |
|-----|---------|-----------------|
| 41 | Roster Count | `=COUNTIF(E4:E37,">1")` |
| 42 | (+) Rookie Mins | Fill to 12 roster spots, prorated: `*(H1/174)` |
| 43 | (+) Vet Mins | Fill to 14 roster spots, prorated: `*(H1/174)` |
| 44 | `=D1&" Dead Money"` | Team dead cap from Y (e.g., "POR Dead Money") |
| 45 | (tax/apron totals) | R45: `=SUM(R4:R40)+R43+R44` |
| 46 | Team Salary | `=SUM(E4:E40)+E44` |
| 47 | Team Salary (fill to 14) | `=SUM(E4:E40)+E44+E43` |
| 48 | Minimum Level | `=XLOOKUP(E3, SystemValues, [Minimum Level])` |
| 49 | +/- Minimum | `=E46-E48` |
| 50 | Cap Level | `=XLOOKUP(E3, SystemValues, [Salary Cap])` |
| 51 | Cap Space | `=(SUM(E4:E40)+E42+E44)-E50` |
| 52 | Tax Level | `=XLOOKUP(E3, SystemValues, [Tax Level])` |
| 53 | +/- Tax | `=R45-E52` (uses tax salary column for 2025/2026) |
| 54 | Tax Payment | SUMPRODUCT over 'Tax Array' brackets (repeater-aware) |
| 55 | Tax Refund | `=IF(E53<0,-10000000,0)` |
| 56 | Apron 1 Level | `=XLOOKUP(E3, SystemValues, [Apron 1])` |
| 57 | +/- Apron 1 | `=S45-E56` (uses apron salary column) |
| 58 | Apron 2 Level | `=XLOOKUP(E3, SystemValues, [Apron 2])` |
| 59 | +/- Apron 2 | `=S45-E58` |
| 60 | Net Cost | `=E46+E54+E55+E43` |
| 61 | Cost Savings | `=IF(ISBLANK(E62), "", E60-E62)` |
| 62 | Baseline Cost | (user input for scenario comparison) |

### Draft Pick Ownership (rows 64–72)

| Row | Description |
|-----|-------------|
| 64 | Headers: "1st Round" (D), "2nd Round" (K) |
| 65–72 | 2026–2032 picks via `=INDEX('Pick Database'!$D$3:$D$32, MATCH($D$1, ...))` |

---

## 4. Layout / Zones

```
Row 1:     [D1: Team] [E1: 2025] [F1: TODAY()] [H1: Days] [I-N: Repeater flags]
Row 2:     Section headers: "Player Contracts" | "Luxury Tax" | "Apron" | "Depth Chart" | "Contract Calculator"
Row 3:     Column headers: # | Player | 2025 | % | 2026 | % | ... | TK | Tax'25 | Apron'25 | Tax'26 | Apron'26 | 2025 | ...
Rows 4-40: Player roster (A: sorted names via LET/FILTER from Y)
Row 41:    Roster Count
Rows 42-44: Mins + Dead Money
Row 45:    Tax/Apron sum row
Rows 46-62: Team totals dashboard
Row 64-72: Draft pick ownership grid
Cols W-AA: Depth Chart (by year)
Cols AC-AO: Contract Calculators (2 blocks)
```

---

## 5. Cross-Sheet Dependencies

### 2025 reads from:

| Sheet | Range/Table | Purpose |
|-------|-------------|---------|
| **Y** | `Y!$B$3:$P$1137` | Player name + salary matrix |
| **Y** | `Y!$D$2:$J$2` | Year headers (2025–2030) |
| **Y** | `Y!$R$2:$X$2`, `Y!$Y$2:$AE$2` | Tax/Apron salary columns |
| **Y** | `Y!$B:$B` | Player name lookup column |
| **SystemValues** | Named table | Cap/Tax/Apron/Minimum levels by season |
| **'Tax Array'** | `$E$4:$O$200` | Tax bracket calculations |
| **'Pick Database'** | `$B$3:$J$62` | Draft pick ownership by team/year |
| **[2]Y** | External workbook | Some Q column formulas reference `[2]Y!$P:$P` |

### What references 2025:

- No other sheets appear to reference `'2025'!` in the warehouse exports.

---

## 6. Key Formulas

### Player name list with salary sort (A4)

```excel
=_xlfn.LET(
  _xlpm.team,    $D$1,
  _xlpm.yr,      E1,
  _xlpm.hdrs,    Y!$D$2:$P$2,
  _xlpm.tbl,     Y!$B$3:$P$1137,
  _xlpm.colIx,   MATCH(_xlpm.yr, _xlpm.hdrs, 0) + 2,
  _xlpm.teamRows,_xlfn._xlws.FILTER(_xlpm.tbl, INDEX(_xlpm.tbl,,2)=_xlpm.team),
  _xlpm.names,   INDEX(_xlpm.teamRows,,1),
  _xlpm.sal,     INDEX(_xlpm.teamRows,,_xlpm.colIx),
  _xlpm.key,     IFERROR(--_xlpm.sal, -10000000000),
  _xlfn.SORTBY(_xlpm.names, _xlpm.key, -1)
)
```

Filters Y warehouse by team, extracts player names sorted descending by salary.

### Salary lookup (E7)

```excel
=IFERROR(
  _xlfn.LET(
    _xlpm.r, MATCH(D7, Y!$B:$B, 0),
    _xlpm.c, MATCH($E$3, Y!$D$2:$J$2, 0),
    _xlpm.v, INDEX(Y!$D:$J, _xlpm.r, _xlpm.c),
    IF(_xlpm.v="-", 0, _xlpm.v)
  ),
0)
```

### Tax salary lookup (R7)

```excel
=IF(ISTEXT($E7),0,
   IF(OR(ISBLANK($E7),_xlfn.ISFORMULA($E7)),
        IFERROR(
             _xlfn.LET(
                  _xlpm.r, MATCH($D7, Y!$B:$B, 0),
                  _xlpm.c, MATCH($R$3, Y!$R$2:$X$2, 0),
                  _xlpm.v, INDEX(Y!$R:$X, _xlpm.r, _xlpm.c),
                  IF(_xlpm.v="-",0,_xlpm.v)
             ),
        0),
        $E7
   )
)
```

Falls back to cap salary (E7) if no override.

### Tax payment (E54)

```excel
=IF(
  $J$1="Yes",
  SUMPRODUCT(
    (E53>'Tax Array'!$M$4:$M$200) *
    ('Tax Array'!$K$4:$K$200=$E$3) *
    (E53 - 'Tax Array'!$M$4:$M$200) *
    ('Tax Array'!$O$4:$O$200)
  ),
  SUMPRODUCT(
    (E53>'Tax Array'!$G$4:$G$200) *
    ('Tax Array'!$E$4:$E$200=$E$3) *
    (E53 - 'Tax Array'!$G$4:$G$200) *
    ('Tax Array'!$I$4:$I$200)
  )
)
```

Computes luxury tax using repeater (J1=Yes) or standard brackets.

### Dead Money (E44)

```excel
=IFERROR(
  _xlfn.LET(
    _xlpm.r, MATCH(D44, Y!$B:$B, 0),
    _xlpm.c, MATCH($E$3, Y!$D$2:$J$2, 0),
    _xlpm.v, INDEX(Y!$D:$J, _xlpm.r, _xlpm.c),
    IF(_xlpm.v="-", 0, _xlpm.v)
  ),
0)
```

Where D44 = `=D1&" Dead Money"` (e.g., "POR Dead Money").

---

## 7. Mapping to Postgres

| 2025 Concept | Our Table(s) |
|--------------|--------------|
| Player salaries by year | `pcms.salary_book_warehouse` |
| Tax/Apron salaries | `pcms.salary_book_warehouse` (tax_2025, apron_2025, etc.) |
| Team selector + roster | `pcms.salary_book_warehouse WHERE team_code = ?` |
| Cap/Tax/Apron levels | `pcms.league_system_values` |
| Dead money | `pcms.dead_money_warehouse` |
| Trade kicker display | `pcms.salary_book_warehouse.trade_kicker_display` |
| Draft pick ownership | `pcms.draft_picks`, `pcms.draft_picks_warehouse` |
| Tax bracket calcs | `pcms.league_tax_rates` + `pcms.tax_team_status` |
| Team totals | `pcms.team_salary_warehouse` |
| Repeater status | `pcms.tax_team_status` (or computed from 3-year tax history) |

---

## 8. Differences from Playground

| Aspect | 2025.json | playground.json |
|--------|-----------|-----------------|
| Base year | Fixed to 2025 | User input (E1) |
| Rows | 74 | 70 |
| Tax/Apron columns | R,S,T,U for 2025/2026 | Same structure |
| Contract calculator | Slightly different layout (AC–AO) | Y–AK |
| External refs | References `[2]Y!` (external workbook) in some cells | Same |

The sheets are functionally equivalent — 2025 is a frozen snapshot for 2025-season analysis.

---

## 9. Open Questions / TODO

- [ ] `por.json` is another snapshot with D1=POR. Determine if these team-specific sheets add value vs parameterized Playground.
- [ ] External workbook reference `[2]Y!` — need to resolve what this maps to (likely an older Y version).
- [ ] Repeater flags (J1/N1) are hardcoded — should derive from `pcms.tax_team_status`.
- [ ] Contract Calculator blocks are standalone — consider as utility functions.
- [ ] Tax Array integration: verify our `pcms.league_tax_rates` matches Sean's SUMPRODUCT pattern.
