<% payload = @overlay_payload || {} %>
<% selected_delta_class = case payload[:selected_delta_variant]
when "positive"
  "text-emerald-600 dark:text-emerald-400"
when "negative"
  "text-red-500"
when "neutral"
  "text-foreground"
else
  "text-muted-foreground"
end %>

<% focus_delta_class = case payload[:focus_delta_variant]
when "positive"
  "text-emerald-600 dark:text-emerald-400"
when "negative"
  "text-red-500"
when "neutral"
  "text-foreground"
else
  "text-muted-foreground"
end %>

<div id="rightpanel-overlay" class="h-full bg-background border-l border-border/70">
  <div class="sticky top-0 z-20 h-10 px-4 flex items-center justify-between border-b border-border bg-background">
    <button
      type="button"
      class="cursor-pointer text-xs text-muted-foreground hover:text-foreground hover:underline"
      data-on:click="$svoverlaysection=''; $svoverlaymetric=''; $svoverlayyear=''; $svoverlaylower=''; $svoverlayupper=''; @get('<%= tools_system_values_sidebar_clear_path %>')"
    >Close</button>

    <a class="text-xs text-muted-foreground hover:text-foreground hover:underline" href="<%= tools_system_values_path(@state_params) %>">Open canonical URL</a>
  </div>

  <div class="px-4 py-4 space-y-4 overflow-y-auto h-[calc(100%-40px)]">
    <div class="space-y-1">
      <div class="text-[10px] uppercase tracking-wide font-semibold text-muted-foreground/80"><%= payload[:section_title] %></div>
      <h2 class="text-base font-semibold text-foreground"><%= payload[:metric_label] %></h2>
      <div class="text-[11px] text-muted-foreground/80 font-mono tabular-nums"><%= payload[:focus_year_label] %><% if payload[:bracket_label].present? %> · <%= payload[:bracket_label] %><% end %></div>
    </div>

    <div class="rounded border border-border bg-muted/20 px-3 py-2 space-y-1.5 text-[11px]">
      <div class="font-medium"><%= payload[:summary_line] %></div>
      <div class="text-muted-foreground"><%= payload[:focus_line] %></div>
    </div>

    <div class="grid grid-cols-2 gap-2 text-[11px]">
      <div class="rounded border border-border bg-background px-2 py-1.5">
        <div class="text-[10px] uppercase tracking-wide text-muted-foreground/80"><%= payload[:selected_year_label] %></div>
        <div class="font-semibold font-mono tabular-nums"><%= payload[:selected_value_label] %></div>
        <div class="mt-0.5 font-mono tabular-nums <%= selected_delta_class %>">Δ <%= payload[:selected_delta_label] %></div>
      </div>

      <div class="rounded border border-border bg-background px-2 py-1.5">
        <div class="text-[10px] uppercase tracking-wide text-muted-foreground/80"><%= payload[:baseline_year_label] %></div>
        <div class="font-semibold font-mono tabular-nums"><%= payload[:baseline_value_label] %></div>
        <div class="mt-0.5 text-[10px] uppercase tracking-wide text-muted-foreground">baseline</div>
      </div>

      <div class="rounded border border-border bg-background px-2 py-1.5 col-span-2">
        <div class="text-[10px] uppercase tracking-wide text-muted-foreground/80">Focused row (<%= payload[:focus_year_label] %>)</div>
        <div class="font-semibold font-mono tabular-nums"><%= payload[:focus_value_label] %></div>
        <div class="mt-0.5 font-mono tabular-nums <%= focus_delta_class %>">Δ <%= payload[:focus_delta_label] %> vs <%= payload[:baseline_year_label] %></div>
      </div>
    </div>

    <div class="rounded border border-border bg-background px-3 py-2 space-y-1.5 text-[11px]">
      <div class="text-[10px] uppercase tracking-wide font-semibold text-muted-foreground/80">Provenance</div>
      <div class="font-mono tabular-nums text-muted-foreground">Source table: <%= payload[:source_table] %></div>
    </div>

    <div class="rounded border border-border bg-background px-3 py-2 space-y-1.5 text-[11px]">
      <div class="text-[10px] uppercase tracking-wide font-semibold text-muted-foreground/80">Pivots</div>
      <% Array(payload[:pivot_links]).each do |pivot| %>
        <a class="block text-blue-600 dark:text-blue-400 hover:underline" href="<%= pivot[:href] %>"><%= pivot[:label] %></a>
      <% end %>
    </div>
  </div>
</div>
