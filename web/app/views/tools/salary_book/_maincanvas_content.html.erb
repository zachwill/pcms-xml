<% boot_error ||= nil %>
<% team_codes ||= [] %>
<% salary_years ||= SalaryBookHelper::SALARY_YEARS %>
<% players_by_team ||= {} %>
<% cap_holds_by_team ||= {} %>
<% exceptions_by_team ||= {} %>
<% dead_money_by_team ||= {} %>
<% picks_by_team ||= {} %>
<% team_summaries ||= {} %>
<% team_meta_by_code ||= {} %>

<% if boot_error.present? %>
  <div class="p-6">
    <div class="text-sm font-medium text-destructive">Warehouse not available</div>
    <div class="mt-2 text-xs text-muted-foreground">
      Booted Rails, but querying <code>pcms.*</code> failed:
    </div>
    <pre class="mt-3 p-3 rounded-lg bg-muted/30 border border-border/50 text-xs overflow-auto"><%= boot_error %></pre>
  </div>
<% elsif team_codes.empty? %>
  <div class="flex items-center justify-center h-96 text-muted-foreground">
    No rows returned from <code>pcms.team_salary_warehouse</code> for <code><%= salary_year %></code>.
  </div>
<% else %>
  <div class="min-h-full">
    <div class="space-y-0">
      <% team_codes.each do |team_code| %>
        <%= render partial: "tools/salary_book/team_section", locals: {
          team_code: team_code,
          players: (players_by_team[team_code] || []),
          cap_holds: (cap_holds_by_team[team_code] || []),
          exceptions: (exceptions_by_team[team_code] || []),
          dead_money: (dead_money_by_team[team_code] || []),
          picks: (picks_by_team[team_code] || []),
          team_summaries: (team_summaries[team_code] || {}),
          team_meta: (team_meta_by_code[team_code] || {}),
          year: salary_year,
          salary_years: salary_years
        } %>
      <% end %>

      <%# Small scroll spacer so the last team header can still reach sticky position %>
      <div aria-hidden class="h-8"></div>
    </div>
  </div>
<% end %>
