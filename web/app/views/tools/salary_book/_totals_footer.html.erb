<%#
  TotalsFooter — Team salary totals, cap space, and tax status per year.

  Dark styling to visually separate from the next team's header.

  Locals:
  - team_summaries: Hash { year => summary_row }
  - salary_years: Array of years to display (defaults to SALARY_YEARS)
  - show_tax_aprons: boolean (default: true)
%>

<% salary_years ||= SalaryBookHelper::SALARY_YEARS %>
<% show_tax_aprons = local_assigns.fetch(:show_tax_aprons, true) %>

<div class="totals-footer">
  <%# Roster Cost Row %>
  <div class="totals-row">
    <div class="totals-sticky-label">
      <div class="totals-label-grid">
        <div class="totals-label-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </div>
        <div class="totals-label-text">Roster Cost</div>
      </div>
    </div>

    <div class="totals-values">
      <% SALARY_YEARS.each do |year| %>
        <% summary = team_summaries[year] %>
        <% cap_total = summary&.dig("cap_total") %>
        <div class="totals-year-cell">
          <div class="totals-kpi-card totals-kpi-card--dark">
            <span class="totals-kpi-label"><%= format_year_label(year) %></span>
            <span class="totals-kpi-value"><%= cap_total ? format_compact_currency(cap_total) : "—" %></span>
          </div>
        </div>
      <% end %>

      <%# Spacers to align with table %>
      <div class="totals-spacer"></div>
      <div class="totals-spacer-wide"></div>
    </div>
  </div>

  <%# Cap Space Row %>
  <div class="totals-row">
    <div class="totals-sticky-label">
      <div class="totals-label-grid">
        <div class="totals-label-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></svg>
        </div>
        <div class="totals-label-text">Cap Space</div>
      </div>
    </div>

    <div class="totals-values">
      <% SALARY_YEARS.each do |year| %>
        <% summary = team_summaries[year] %>
        <% cap_space = summary&.dig("cap_space") %>
        <% variant = cap_space && cap_space.to_f >= 0 ? "positive" : "negative" %>
        <div class="totals-year-cell">
          <div class="totals-kpi-card totals-kpi-card--dark totals-kpi-card--<%= variant %>">
            <span class="totals-kpi-label"><%= format_year_label(year) %></span>
            <span class="totals-kpi-value totals-kpi-value--<%= variant %>">
              <%= cap_space ? format_room_amount(cap_space) : "—" %>
            </span>
          </div>
        </div>
      <% end %>

      <div class="totals-spacer"></div>
      <div class="totals-spacer-wide"></div>
    </div>
  </div>

  <%# Tax Status Row %>
  <% if show_tax_aprons %>
    <div class="totals-row">
      <div class="totals-sticky-label">
        <div class="totals-label-grid">
          <div class="totals-label-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
          </div>
          <div class="totals-label-text">Tax Status</div>
        </div>
      </div>

      <div class="totals-values">
        <% SALARY_YEARS.each do |year| %>
          <% summary = team_summaries[year] %>
          <% status = tax_status(summary) %>
          <div class="totals-year-cell">
            <div class="totals-kpi-card totals-kpi-card--dark totals-kpi-card--<%= status[:variant] %>">
              <span class="totals-kpi-label"><%= status[:label] %></span>
              <span class="totals-kpi-value totals-kpi-value--<%= status[:variant] %>">
                <%= status[:value] %>
              </span>
            </div>
          </div>
        <% end %>

        <div class="totals-spacer"></div>
        <div class="totals-spacer-wide"></div>
      </div>
    </div>
  <% end %>
</div>
