summary: Import NBA data
description: ''
value:
  modules:
    - id: a
      summary: Teams
      value:
        type: rawscript
        content: '!inline teams.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline teams.inline_script.lock'
        language: python3
    - id: b
      summary: Players
      value:
        type: rawscript
        content: '!inline players.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline players.inline_script.lock'
        language: python3
    - id: c
      summary: Schedules
      value:
        type: rawscript
        content: '!inline schedules.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline schedules.inline_script.lock'
        language: python3
    - id: d
      summary: Standings
      value:
        type: rawscript
        content: '!inline standings.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline standings.inline_script.lock'
        language: python3
    - id: e
      summary: Games
      value:
        type: rawscript
        content: '!inline games.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline games.inline_script.lock'
        language: python3
    - id: f
      summary: Game Data
      value:
        type: rawscript
        content: '!inline game_data.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline game_data.inline_script.lock'
        language: python3
    - id: g
      summary: Aggregates
      value:
        type: rawscript
        content: '!inline aggregates.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline aggregates.inline_script.lock'
        language: python3
    - id: h
      summary: Supplemental
      value:
        type: rawscript
        content: '!inline supplemental.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline supplemental.inline_script.lock'
        language: python3
    - id: i
      summary: NGSS
      value:
        type: rawscript
        content: '!inline ngss.inline_script.py'
        input_transforms:
          dry_run:
            type: javascript
            expr: flow_input.dry_run
          league_id:
            type: javascript
            expr: flow_input.league_id
          season_label:
            type: javascript
            expr: flow_input.season_label
          season_type:
            type: javascript
            expr: flow_input.season_type
          mode:
            type: javascript
            expr: flow_input.mode
          days_back:
            type: javascript
            expr: flow_input.days_back
          start_date:
            type: javascript
            expr: flow_input.start_date
          end_date:
            type: javascript
            expr: flow_input.end_date
          game_ids:
            type: javascript
            expr: flow_input.game_ids
          include_reference:
            type: javascript
            expr: flow_input.include_reference
          include_schedule_and_standings:
            type: javascript
            expr: flow_input.include_schedule_and_standings
          include_games:
            type: javascript
            expr: flow_input.include_games
          include_game_data:
            type: javascript
            expr: flow_input.include_game_data
          include_aggregates:
            type: javascript
            expr: flow_input.include_aggregates
          include_supplemental:
            type: javascript
            expr: flow_input.include_supplemental
          include_ngss:
            type: javascript
            expr: flow_input.include_ngss
          only_final_games:
            type: javascript
            expr: flow_input.only_final_games
        lock: '!inline ngss.inline_script.lock'
        language: python3

  same_worker: true
schema:
  $schema: 'https://json-schema.org/draft/2020-12/schema'
  type: object
  order:
    - dry_run
    - league_id
    - season_label
    - season_type
    - mode
    - days_back
    - start_date
    - end_date
    - game_ids
    - include_reference
    - include_schedule_and_standings
    - include_games
    - include_game_data
    - include_aggregates
    - include_supplemental
    - include_ngss
    - only_final_games
  properties:
    dry_run:
      type: boolean
      description: Preview changes without writing to DB
      default: false
    league_id:
      type: string
      description: League ID (00=NBA, 10=WNBA, 20=G League)
      default: '00'
    season_label:
      type: string
      description: Season label (e.g., 2024-25)
      default: '2024-25'
    season_type:
      type: string
      description: Season type (Regular Season, Playoffs, etc.)
      default: 'Regular Season'
    mode:
      type: string
      description: refresh (last N days) or backfill (explicit range)
      enum:
        - refresh
        - backfill
      default: refresh
    days_back:
      type: integer
      description: Days back for refresh mode
      default: 2
    start_date:
      type: string
      description: YYYY-MM-DD (required for backfill unless game_ids provided)
      default: ''
    end_date:
      type: string
      description: YYYY-MM-DD (required for backfill unless game_ids provided)
      default: ''
    game_ids:
      type: string
      description: Comma-separated game IDs (optional override)
      default: ''
    include_reference:
      type: boolean
      description: Fetch + upsert teams/players
      default: true
    include_schedule_and_standings:
      type: boolean
      description: Fetch + upsert schedules + standings
      default: true
    include_games:
      type: boolean
      description: Fetch + upsert games (scoreboard)
      default: true
    include_game_data:
      type: boolean
      description: Fetch + upsert boxscores/pbp/poc (+ optional hustle/tracking)
      default: true
    include_aggregates:
      type: boolean
      description: Fetch + upsert player/team aggregate stats
      default: false
    include_supplemental:
      type: boolean
      description: Fetch + upsert injuries/alerts/storylines/tracking streams
      default: false
    include_ngss:
      type: boolean
      description: Fetch + upsert NGSS game/boxscore/pbp/roster/officials data
      default: false
    only_final_games:
      type: boolean
      description: Only fetch game_data for games with game_status=3
      default: true
